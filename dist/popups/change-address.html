<div class="mfp-popup mfp-anim change-address">
  <div class="mfp-popup-title popup-review-title">
    Адреса
  </div>
  <div class="change-address-body">
    <form action="#" class="change-address-form">
      <div class="change-address-main">
        <div class="change-address-title">
          Основной адрес доставки
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="ui-field">
              <label class="ui-label ui-label-mini" for="locality">Населённый пункт <span class="ui-color-red">*</span></label>
              <div class="ui-input-wrp">
                <input type="text" name="locality" id="locality" class="ui-input locality" placeholder="Минск">
                <div class="popup-icon"></div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="ui-field">
              <label class="ui-label ui-label-mini" for="street">Улица <span class="ui-color-red">*</span></label>
              <div class="ui-input-wrp">
                <input type="text" name="street" id="street" class="ui-input street" placeholder="Первомайская">
                <div class="popup-icon"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-2 col-ss-6">
            <div class="ui-field">
              <label class="ui-label ui-label-mini" for="house">Дом <span class="ui-color-red">*</span></label>
              <div class="ui-input-wrp">
                <input type="text" name="house" id="house" class="ui-input house">
                <div class="popup-icon"></div>
              </div>
            </div>
          </div>
          <div class="col-md-2 col-ss-6">
            <div class="ui-field">
              <label class="ui-label ui-label-mini" for="building ">Корпус</label>
              <div class="ui-input-wrp">
                <input type="text" name="building " id="building" class="ui-input building">
                <div class="popup-icon"></div>
              </div>
            </div>
          </div>
          <div class="col-md-2 col-ss-6">
            <div class="ui-field">
              <label class="ui-label ui-label-mini" for="apartment">Квартира/Офис</label>
              <div class="ui-input-wrp">
                <input type="text" name="apartment" id="apartment" class="ui-input apartment">
                <div class="popup-icon"></div>
              </div>
            </div>
          </div>
          <div class="col-md-2 col-ss-6">
            <div class="ui-field">
              <label class="ui-label ui-label-mini" for="entrance">Подъезд</label>
              <div class="ui-input-wrp">
                <input type="text" name="entrance" id="entrance" class="ui-input entrance">
                <div class="popup-icon"></div>
              </div>
            </div>
          </div>
          <div class="col-md-2 col-ss-6">
            <div class="ui-field">
              <label class="ui-label ui-label-mini" for="floor">Этаж</label>
              <div class="ui-input-wrp">
                <input type="text" name="floor" id="floor" class="ui-input floor">
                <div class="popup-icon"></div>
              </div>
            </div>
          </div>
          <div class="col-md-2 col-ss-6">
            <div class="ui-field">
              <label class="ui-label ui-label-mini" for="intercomCode">Код домофона</label>
              <div class="ui-input-wrp">
                <input type="text" name="intercomCode" id="intercomCode" class="ui-input intercomCode">
                <div class="popup-icon"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="change-address-second">
        <div class="change-address-title margin">
          Дополнительные адреса доставки
        </div>

        <div class="change-address-new"></div>

        <div class="change-address-btn">Добавить</div>
      </div>

      <div class="change-address-confirm">
        <div class="row">
          <div class="col-md-6">
            <div class="ui-checkbox">
              <div class="ui-checkbox-body">
                <input type="checkbox" id="customCheckbox" class="ui-checkbox-input" name="customCheckbox" checked="">
                <label for="customCheckbox" class="ui-checkbox-label">Нажимая кнопку «Сохранить» вы соглашаетесь с <a href="#">политикой обработки персональных данных.</a></label>
              </div>
            </div>
          </div>

          <div class="col-md-6">
            <button type="submit" class="ui-btn ui-btn-block ui-btn-blue margin-31">Сохранить</button>
          </div>
        </div>
      </div>
    </form>
  </div>

  <script>
    $( document ).ready(function() {
      //acount add address
      let btnAdd = document.querySelector('.change-address-btn');
      let field = document.querySelector('.ui-field');
      let block = document.querySelector('.change-address-second .change-address-new');
      let blockSecond = document.querySelector('.change-address-second');
      let mainInputLocality = document.querySelector('.locality');
      let mainInputStreet = document.querySelector('.change-address-main .street');
      let mainInputHouse = document.querySelector('.change-address-main .house');
      let mainInputBuilding = document.querySelector('.change-address-main .building');
      let mainInputApartment = document.querySelector('.change-address-main .apartment');
      let mainInputEntrance = document.querySelector('.change-address-main .entrance');
      let mainInputFloor = document.querySelector('.change-address-main .floor');
      let mainInputIntercomCode = document.querySelector('.change-address-main .intercomCode');
      let count = 1;


      blockSecond.addEventListener('click', (e) => {
        let parentBlock = e.target.closest('.change-address-new');
        let thisForm = e.target.closest('.change-address-main');
        let thisElementClass = e.target.classList[0];
        let findElement = e.target.closest('.change-address-inputs');

        if(thisElementClass === 'change-address-remove') {
          thisForm.remove();
        }

        if(thisForm === null) return

        let inputLocality = thisForm.querySelector('.locality');
        let inputStreet = thisForm.querySelector('.street');
        let inputHouse = thisForm.querySelector('.house');
        let inputApartment = thisForm.querySelector('.apartment');
        let inputBuilding = thisForm.querySelector('.building');
        let inputEntrance = thisForm.querySelector('.entrance');
        let inputFloor = thisForm.querySelector('.floor');
        let inputIntercomCode = thisForm.querySelector('.intercomCode');

        if(thisElementClass === 'change-address-basic') {
          mainInputLocality.value = inputLocality.value;
          mainInputStreet.value = inputStreet.value;
          mainInputHouse.value = inputHouse.value;
          mainInputBuilding.value = inputBuilding.value;
          mainInputApartment.value = inputApartment.value;
          mainInputEntrance.value = inputEntrance.value;
          mainInputFloor.value = inputFloor.value;
          mainInputIntercomCode.value = inputIntercomCode.value;
        }
      })

      btnAdd.addEventListener('click', () => {
        let blockDiv = document.createElement('div');
        blockDiv.classList.add('change-address-main')

        blockDiv.innerHTML = `
        <div class="change-address-headline">
          <div class="change-address-title second">
            Адрес №${count++}
          </div>

          <div class="change-address-control">
            <div class="change-address-basic">Сделать основным</div>
            <div class="change-address-remove">Удалить</div>
          </div>
        </div>

        <div class="change-address-inputs">
          <div class="row">
            <div class="col-md-6">
              <div class="ui-field">
                <label class="ui-label ui-label-mini" for="locality">Населённый пункт</label>
                <div class="ui-input-wrp">
                  <input type="text" name="locality" id="locality" class="ui-input locality" placeholder="Минск">
                  <div class="popup-icon"></div>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="ui-field">
                <label class="ui-label ui-label-mini" for="street">Улица</label>
                <div class="ui-input-wrp">
                  <input type="text" name="street" id="street" class="ui-input street" placeholder="Первомайская">
                  <div class="popup-icon"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-2 col-ss-6">
              <div class="ui-field">
                <label class="ui-label ui-label-mini" for="house">Дом</label>
                <div class="ui-input-wrp">
                  <input type="text" name="house" id="house" class="ui-input house">
                  <div class="popup-icon"></div>
                </div>
              </div>
            </div>
            <div class="col-md-2 col-ss-6">
              <div class="ui-field">
                <label class="ui-label ui-label-mini" for="building">Корпус</label>
                <div class="ui-input-wrp">
                  <input type="text" name="building" id="building" class="ui-input building">
                  <div class="popup-icon"></div>
                </div>
              </div>
            </div>
            <div class="col-md-2 col-ss-6">
              <div class="ui-field">
                <label class="ui-label ui-label-mini" for="apartment">Квартира/Офис</label>
                <div class="ui-input-wrp">
                  <input type="text" name="apartment" id="apartment" class="ui-input apartment">
                  <div class="popup-icon"></div>
                </div>
              </div>
            </div>
            <div class="col-md-2 col-ss-6">
              <div class="ui-field">
                <label class="ui-label ui-label-mini" for="entrance">Подъезд</label>
                <div class="ui-input-wrp">
                  <input type="text" name="entrance" id="entrance" class="ui-input entrance">
                  <div class="popup-icon"></div>
                </div>
              </div>
            </div>
            <div class="col-md-2 col-ss-6">
              <div class="ui-field">
                <label class="ui-label ui-label-mini" for="floor">Этаж</label>
                <div class="ui-input-wrp">
                  <input type="text" name="floor" id="floor" class="ui-input floor">
                  <div class="popup-icon"></div>
                </div>
              </div>
            </div>
            <div class="col-md-2 col-ss-6">
              <div class="ui-field">
                <label class="ui-label ui-label-mini" for="intercomCode">Код домофона</label>
                <div class="ui-input-wrp">
                  <input type="text" name="intercomCode" id="intercomCode" class="ui-input intercomCode">
                  <div class="popup-icon"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        `

        block.append(blockDiv)
      })

      $(".change-address-form").validate({
      errorElement: "span",
      rules: {
        locality: {
          required: true,
          lettersonly: true,
        },

        street: {
          required: true,
          lettersonly: true,
        },

        house: {
          required: true,
          number: true,
        },

        customCheckbox: {
          required: true,
        }
      },

      highlight: function(element, errorClass, validClass) {
        $(element).addClass(errorClass).removeClass(validClass);
        $(element).closest('.ui-field').find('.popup-icon')
          .addClass(errorClass).removeClass(validClass);

      },
      unhighlight: function(element, errorClass, validClass) {
        $(element).removeClass(errorClass).addClass(validClass);
        $(element).closest('.ui-field').find('.popup-icon')
          .removeClass(errorClass).addClass(validClass);
      },

      errorPlacement: function (error, element) {
        if (element.attr("name") == "customCheckbox") {
          error.appendTo(".form-cell-field-send");
        } else {
          error.insertAfter(element);
        }

        if (element.hasClass('ui-checkbox-input')) {
          element.closest('.ui-checkbox-body').after(error);
        }
      },

      messages: {
        locality: {
          required: "Введите населенный пункт",
          lettersonly: "Введите данные",
        },


        street: {
          required: "Введите улицу",
          lettersonly: "Введите данные",
        },

        house: {
          required: "Введите номер дома",
          number: "Введите данные",
        },

        customCheckbox: {
          required: 'Подтвердите ваше согласие с условиями'
        }
      },
    });
    });
  </script>
</div>